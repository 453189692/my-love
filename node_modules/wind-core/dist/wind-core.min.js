/*!
 * author: sakitam-fdd <smilefdd@gmail.com> 
 * wind-core v1.0.0-alpha.4
 * build-time: 2020-5-17 15:38
 * LICENSE: MIT
 * (c) 2017-2020 https://github.com/sakitam-fdd/wind-layer#readme
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).WindCore={})}(this,(function(t){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,r)};function r(){for(var t=arguments,e=0,r=0,i=arguments.length;r<i;r++)e+=t[r].length;var n=Array(e),o=0;for(r=0;r<i;r++)for(var a=arguments[r],s=0,c=a.length;s<c;s++,o++)n[o]=a[s];return n}Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(t,e){var r=arguments;if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(t),n=1;n<arguments.length;n++){var o=r[n];if(null!=o)for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(i[a]=o[a])}return i},writable:!0,configurable:!0});var i=Object.prototype.hasOwnProperty,n="undefined"!=typeof Symbol?Symbol.toStringTag:void 0;function o(t){if(!a(t))return!1;var e=function(t){if(null===t)return void 0===t?"[object Undefined]":"[object Null]";if(!(n&&n in Object(t)))return toString.call(t);var e=i.call(t,n),r=t[n],o=!1;try{t[n]=void 0,o=!0}catch(t){}var a=Object.prototype.toString.call(t);return o&&(e?t[n]=r:delete t[n]),a}(t);return"[object Function]"===e||"[object AsyncFunction]"===e||"[object GeneratorFunction]"===e||"[object Proxy]"===e}function a(t){var e=typeof t;return null!==t&&("object"===e||"function"===e)}function s(t){return null!=t&&("string"==typeof t||null!==t.constructor&&t.constructor===String)}function c(t){return"[object Number]"===Object.prototype.toString.call(t)&&!isNaN(t)}function h(t,e){return t-e*Math.floor(t/e)}function u(t){return null!=t&&!isNaN(t)}var l=/(\D+)/,p=/^#([a-f0-9]{6})([a-f0-9]{2})?$/i,f=/^rgba?\(\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/,d={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function m(t){var e=[];if(t.match(p)){if(null!==(n=t.match(p))){n=n[1];for(var r=0;r<3;r++){var i=2*r;e[r]=parseInt(n.slice(i,i+2),16)}e[3]=1}}else{if(!t.match(f))return t.match(l)?"transparent"===(n=t.match(l))[1]?[0,0,0,0]:(e=d[n[1]])?(e[3]=1,e):null:null;var n=t.match(f);for(r=0;r<3;r++)e[r]=parseInt(n[r+1],0);n[4]?e[3]=parseFloat(n[4]):e[3]=1}return e}var g=function(){function t(t,e){this.u=t,this.v=e,this.m=this.magnitude()}return t.prototype.magnitude=function(){return Math.sqrt(this.u*this.u+this.v*this.v)},t.prototype.directionTo=function(){var t=Math.atan2(this.u,this.v)*(180/Math.PI);return t<0&&(t+=360),t},t.prototype.directionFrom=function(){return(this.directionTo()+180)%360},t}(),v=function(){function t(t){this.grid=[],this.xmin=t.xmin,this.xmax=t.xmax,this.ymin=Math.min(t.ymax,t.ymin),this.ymax=Math.max(t.ymax,t.ymin),this.cols=t.cols,this.rows=t.rows,this.us=t.us,this.vs=t.vs,this.deltaX=t.deltaX,this.deltaY=t.deltaY,this.isFields=!0;var e=Math.ceil((this.xmax-this.xmin)/t.deltaX),r=Math.ceil((this.ymax-this.ymin)/t.deltaY);e===this.cols&&r===this.rows||console.warn("The data grid not equal"),this.isContinuous=Math.floor(this.cols*t.deltaX)>=360,this.wrappedX="wrappedX"in t?t.wrappedX:this.xmax>180,this.grid=this.buildGrid(),this.range=this.calculateRange()}return t.prototype.buildGrid=function(){for(var t=[],e=0,r=this.rows,i=this.cols,n=this.us,o=this.vs,a=0;a<r;a++){for(var s=[],c=0;c<i;c++,e++){var h=n[e],u=o[e],l=this.isValid(h)&&this.isValid(u);s[c]=l?new g(h,u):null}this.isContinuous&&s.push(s[0]),t[a]=s}return t},t.prototype.release=function(){this.grid=[],this.columns=[]},t.prototype.extent=function(){return[this.xmin,this.ymin,this.xmax,this.ymax]},t.prototype.bilinearInterpolateVector=function(t,e,r,i,n,o){var a=1-t,s=1-e,c=a*s,h=t*s,u=a*e,l=t*e,p=r.u*c+i.u*h+n.u*u+o.u*l,f=r.v*c+i.v*h+n.v*u+o.v*l;return new g(p,f)},t.prototype.calculateRange=function(){if(this.grid&&this.grid[0]){for(var t,e,r=this.grid.length,i=this.grid[0].length,n=0;n<r;n++)for(var o=0;o<i;o++){var a=this.grid[n][o];if(null!==a){var s=a.m||a.magnitude();void 0===t?t=s:void 0===e?(e=s,t=Math.min(t,e),e=Math.max(t,e)):(t=Math.min(s,t),e=Math.max(s,e))}}return[t,e]}},t.prototype.isValid=function(t){return null!=t},t.prototype.getWrappedLongitudes=function(){var t=this.xmin,e=this.xmax;return this.wrappedX&&(this.isContinuous?(t=-180,e=180):(e=this.xmax-360,t=this.xmin-360)),[t,e]},t.prototype.contains=function(t,e){var r=this.getWrappedLongitudes(),i=r[0],n=r[1],o=t>=i&&t<=n,a=e>=this.ymin&&e<=this.ymax;return o&&a},t.prototype.getDecimalIndexes=function(t,e){return[h(t-this.xmin,360)/this.deltaX,(this.ymax-e)/this.deltaY]},t.prototype.valueAt=function(t,e){if(!this.contains(t,e))return null;var r=this.getDecimalIndexes(t,e),i=Math.floor(r[0]),n=Math.floor(r[1]),o=this.clampColumnIndex(i),a=this.clampRowIndex(n);return this.valueAtIndexes(o,a)},t.prototype.interpolatedValueAt=function(t,e){if(!this.contains(t,e))return null;var r=this.getDecimalIndexes(t,e),i=r[0],n=r[1];return this.interpolatePoint(i,n)},t.prototype.hasValueAt=function(t,e){return null!==this.valueAt(t,e)},t.prototype.interpolatePoint=function(t,e){var r=this.getFourSurroundingIndexes(t,e),i=r[0],n=r[1],o=r[2],a=r[3],s=this.getFourSurroundingValues(i,n,o,a);if(s){var c=s[0],h=s[1],u=s[2],l=s[3];return this.bilinearInterpolateVector(t-i,e-o,c,h,u,l)}return null},t.prototype.clampColumnIndex=function(t){var e=t;t<0&&(e=0);var r=this.cols-1;return t>r&&(e=r),e},t.prototype.clampRowIndex=function(t){var e=t;t<0&&(e=0);var r=this.rows-1;return t>r&&(e=r),e},t.prototype.getFourSurroundingIndexes=function(t,e){var r=Math.floor(t),i=r+1;this.isContinuous&&i>=this.cols&&(i=0),i=this.clampColumnIndex(i);var n=this.clampRowIndex(Math.floor(e));return[r,i,n,this.clampRowIndex(n+1)]},t.prototype.getFourSurroundingValues=function(t,e,r,i){var n;if(n=this.grid[r]){var o=n[t],a=n[e];if(this.isValid(o)&&this.isValid(a)&&(n=this.grid[i])){var s=n[t],c=n[e];if(this.isValid(s)&&this.isValid(c))return[o,a,s,c]}}return null},t.prototype.valueAtIndexes=function(t,e){return this.grid[e][t]},t.prototype.lonLatAtIndexes=function(t,e){return[this.longitudeAtX(t),this.latitudeAtY(e)]},t.prototype.longitudeAtX=function(t){var e=this.deltaX/2,r=this.xmin+e+t*this.deltaX;return this.wrappedX&&(r=r>180?r-360:r),r},t.prototype.latitudeAtY=function(t){var e=this.deltaY/2;return this.ymax-e-t*this.deltaY},t.prototype.randomize=function(t,e,r,i){void 0===t&&(t={});var n=Math.random()*(e||this.cols)|0,o=Math.random()*(r||this.rows)|0,a=i([n,o]);return null!==a?(t.x=a[0],t.y=a[1]):(t.x=this.longitudeAtX(n),t.y=this.latitudeAtY(o)),t},t.prototype.checkFields=function(){return this.isFields},t.prototype.startBatchInterpolate=function(t,e,r){},t}();function y(){return devicePixelRatio||1}function x(t,e){if(!t)return!1;if(e=e||y(),!(t instanceof OffscreenCanvas)){var r=t.clientWidth*e,i=t.clientHeight*e;if(r<=0||i<=0)return!1;if(t.width!==r||t.height!==i)return t.width=r,t.height=i,!0}return!1}function b(t,e,r){var i=t.createShader(e);if(t.shaderSource(i,r),t.compileShader(i),!t.getShaderParameter(i,t.COMPILE_STATUS))throw t.deleteShader(i),new Error(t.getShaderInfoLog(i)||"");return i}function w(t,e,r){var i=b(t,t.VERTEX_SHADER,e),n=b(t,t.FRAGMENT_SHADER,r),o=t.createProgram();if(null!==o&&(t.attachShader(o,i),t.attachShader(o,n),t.linkProgram(o),!t.getProgramParameter(o,t.LINK_STATUS)))throw new Error(t.getProgramInfoLog(o)||"");return o}function A(t,e){var r=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,r),e&&t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW),r}function S(t,e){var r=e[0],i=e[1],n=e[2],o=e[3];t.viewport(0,0,t.canvas.width,t.canvas.height),t.clearColor(r,i,n,o),t.clearDepth(1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),t.enable(t.DEPTH_TEST)}var T="undefined"!=typeof Float32Array?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=arguments,e=0,r=arguments.length;r--;)e+=t[r]*t[r];return Math.sqrt(e)});var E=function(){function t(t,e,r){var i;this.vertShader="",this.fragShader="",e&&(this.vertShader=e),r&&(this.fragShader=r),this.program=w(t,this.vertShader,this.fragShader),this.gl=t,this.textureUnit=0,this.uniformSetters=this.createUniformSetters(),this.attribSetters=this.createAttributeSetters(),this.transfromStack=[],this.projection=(i=new T(9),T!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i)}return t.prototype.active=function(){return this.gl.useProgram(this.program),this},t.prototype.deactive=function(){return this.gl.deleteProgram(this.program),this},t.prototype.getBindPointForSamplerType=function(t,e){return e===t.SAMPLER_2D?t.TEXTURE_2D:e===t.SAMPLER_CUBE?t.TEXTURE_CUBE_MAP:void 0},t.prototype.createUniformSetter=function(t,e){var r,i,n=this.gl,o=n.getUniformLocation(t,e.name),a=e.type,s=e.size>1&&"[0]"===e.name.substr(-3);if(a===n.FLOAT&&s)return function(t){n.uniform1fv(o,t)};if(a===n.FLOAT)return function(t){n.uniform1f(o,t)};if(a===n.FLOAT_VEC2)return function(t){n.uniform2fv(o,t)};if(a===n.FLOAT_VEC3)return function(t){n.uniform3fv(o,t)};if(a===n.FLOAT_VEC4)return function(t){n.uniform4fv(o,t)};if(a===n.INT&&s)return function(t){n.uniform1iv(o,t)};if(a===n.INT)return function(t){n.uniform1i(o,t)};if(a===n.INT_VEC2)return function(t){n.uniform2iv(o,t)};if(a===n.INT_VEC3)return function(t){n.uniform3iv(o,t)};if(a===n.INT_VEC4)return function(t){n.uniform4iv(o,t)};if(a===n.BOOL)return function(t){n.uniform1iv(o,t)};if(a===n.BOOL_VEC2)return function(t){n.uniform2iv(o,t)};if(a===n.BOOL_VEC3)return function(t){n.uniform3iv(o,t)};if(a===n.BOOL_VEC4)return function(t){n.uniform4iv(o,t)};if(a===n.FLOAT_MAT2)return function(t){n.uniformMatrix2fv(o,!1,t)};if(a===n.FLOAT_MAT3)return function(t){n.uniformMatrix3fv(o,!1,t)};if(a===n.FLOAT_MAT4)return function(t){n.uniformMatrix4fv(o,!1,t)};if((a===n.SAMPLER_2D||a===n.SAMPLER_CUBE)&&s){for(var c=[],h=0;h<e.size;++h)c.push(this.textureUnit++);return function(t,e){return function(r){n.uniform1iv(o,e),r.forEach((function(r,i){n.activeTexture(n.TEXTURE0+e[i]),void 0!==t&&n.bindTexture(t,r)}))}}(this.getBindPointForSamplerType(n,a),c)}if(a===n.SAMPLER_2D||a===n.SAMPLER_CUBE)return r=this.getBindPointForSamplerType(n,a),i=this.textureUnit++,function(t){n.uniform1i(o,i),n.activeTexture(n.TEXTURE0+i),void 0!==r&&n.bindTexture(r,t)};throw"unknown type: 0x"+a.toString(16)},t.prototype.createUniformSetters=function(){var t=this.gl;this.textureUnit=0;var e={};if(null!==this.program)for(var r=t.getProgramParameter(this.program,t.ACTIVE_UNIFORMS),i=0;i<r;++i){var n=t.getActiveUniform(this.program,i);if(!n)break;var o=n.name;"[0]"===o.substr(-3)&&(o=o.substr(0,o.length-3));var a=this.createUniformSetter(this.program,n);e[o]=a}return e},t.prototype.createAttribSetter=function(t){var e=this.gl;return function(r){e.bindBuffer(e.ARRAY_BUFFER,r.buffer),e.enableVertexAttribArray(t),void 0===r.numComponents&&void 0===r.size||e.vertexAttribPointer(t,r.numComponents||r.size,r.type||e.FLOAT,r.normalize||!1,r.stride||0,r.offset||0)}},t.prototype.createAttributeSetters=function(){var t=this.gl,e={};if(null!==this.program)for(var r=t.getProgramParameter(this.program,t.ACTIVE_ATTRIBUTES),i=0;i<r;++i){var n=t.getActiveAttrib(this.program,i);if(!n)break;var o=t.getAttribLocation(this.program,n.name);e[n.name]=this.createAttribSetter(o)}return e},t.prototype.setAttributes=function(t,e){return e=e?e.attribSetters||e:this.attribSetters,Object.keys(t).forEach((function(r){var i=e[r];i&&i(t[r])})),this},t.prototype.setUniforms=function(t,e){return e=e?e.uniformSetters||e:this.uniformSetters,Object.keys(t).forEach((function(r){var i=e[r];i&&i(t[r])})),this},t.prototype.clear=function(t){return S(this.gl,t),this.transfromStack=[],this},t.prototype.runTimes=function(t){return this.count=t||0,this},t.prototype.updateProjection=function(){var t=this.gl.canvas,e=t.width,r=t.height;return function(t,e,r){t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1}(this.projection,e,r),this},t.prototype.resize=function(t){return x(this.gl.canvas),this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height),t&&this.updateProjection(),this},t.prototype.draw=function(){throw new Error("should override")},t.prototype.translate=function(){throw new Error("should override")},t.prototype.rotate=function(){throw new Error("should override")},t.prototype.scale=function(){throw new Error("should override")},t}(),_="precision mediump float;\n#define GLSLIFY 1\n\n// 从顶点着色器中传入\nvarying vec4 v_color;\n\nvoid main() {\n  gl_FragColor = v_color;\n}\n",R="#define GLSLIFY 1\nattribute vec2 a_position;\nattribute vec4 a_color;\n\n//uniform mat4 u_matrix;\nuniform vec2 u_resolution;\nvarying vec4 v_color;\nuniform float u_pointSize;\n\nvoid main() {\n  // convert the rectangle from pixels to 0.0 to 1.0\n  vec2 zeroToOne = a_position / u_resolution;\n\n  // convert from 0->1 to 0->2\n  vec2 zeroToTwo = zeroToOne * 2.0;\n\n  // convert from 0->2 to -1->+1 (clipspace)\n  vec2 clipSpace = zeroToTwo - 1.0;\n\n  // 未翻转Y轴\n  //  gl_Position = vec4(a_position, 0, 1);\n  // 翻转Y轴\n  gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);\n  // Multiply the position by the matrix.\n//  gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\n  // 将颜色传递给片断着色器\n  v_color = a_color;\n\n  gl_PointSize = u_pointSize;\n}\n",P=function(t){function r(e,r,i){var n=t.call(this,e,r||R,i||_)||this;return n.vertShader=R,n.fragShader=_,n}return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}(r,t),r.prototype.updateProjection=function(){return this},r.prototype.draw=function(){var t=this.gl.POINTS;return this.gl.drawArrays(t,0,this.count),this},r.prototype.translate=function(){return this},r.prototype.rotate=function(){return this},r.prototype.scale=function(){return this},r}(E);function C(t,e,r,i){return Math.max(0,Math.min(i.length-1,Math.round((t-e)/(r-e)*(i.length-1))))}var O={colorScale:"#ff473c",emptyColor:"rgba(255, 255, 255, 0)",showArrow:!1,arrowConfig:{},showScalarField:!1,scalarField:{},useGl:!1,useInterpolated:!1,transformCoords:function(){return[]}},F=function(){function t(t,e,r){if(this.ctx=t,!this.ctx)throw new Error("ctx error");this.setOptions(e),r&&this.updateData(r)}return t.prototype.setOptions=function(t){this.options=Object.assign({},O,t)},t.prototype.getOptions=function(){return this.options},t.prototype.updateData=function(t){this.field=t},t.prototype.project=function(t){throw new Error("project must be overriden")},t.prototype.unproject=function(t){throw new Error("unproject must be overriden")},t.prototype.intersectsCoordinate=function(t){throw new Error("intersectsCoordinate must be overriden")},t.prototype.clearCanvas=function(){this.ctx instanceof CanvasRenderingContext2D&&this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height)},t.prototype.createImageData=function(){console.time("prerender");var t=this.ctx.canvas,e=t.width,r=t.height;"getImageData"in this.ctx&&(this.imageData=this.ctx.getImageData(0,0,e,r));for(var i=this.field.range,n=i[0],a=i[1],s=0,c=0;c<r;c++)for(var h=0;h<e;h++){var u=this.options.emptyColor,l=this.unproject([h,c]);if(null!==l){var p=this.field[this.options.useInterpolated?"interpolatedValueAt":"valueAt"](l[0],l[1]);if(p)if(o(this.options.colorScale))u=this.options.colorScale(p.m);else if(Array.isArray(this.options.colorScale)){var f=C(p.m,n,a,this.options.colorScale);u=this.options.colorScale[f]}else u=this.options.colorScale;u=m(u||"rgba(255, 255, 255, 0)")}this.imageData.data[s]=u[0],this.imageData.data[s+1]=u[1],this.imageData.data[s+2]=u[2],this.imageData.data[s+3]=parseInt(255*(u[3]||0)),s+=4}console.timeEnd("prerender")},t.prototype.createBufferData=function(t){var e=[],r=[];if(null!==this.ctx&&this.ctx instanceof WebGLRenderingContext){console.time("prerender");for(var i=this.ctx.canvas,n=i.width,a=i.height,s=this.field.range,c=s[0],h=s[1],u=0;u<a;u++)for(var l=0;l<n;l++){var p=this.options.emptyColor,f=this.unproject([l,u]);if(null!==f){var d=this.field[this.options.useInterpolated?"interpolatedValueAt":"valueAt"](f[0],f[1]);if(d)if(o(this.options.colorScale))p=this.options.colorScale(d.m);else if(Array.isArray(this.options.colorScale)){var g=C(d.m,c,h,this.options.colorScale);p=this.options.colorScale[g]}else p=this.options.colorScale;p=m(p||"rgba(255, 255, 255, 0)"),e.push(l,u),r.push(p[0],p[1],p[2],parseInt(255*(p[3]||0)))}}this.shape?this.shape.setAttributes({a_position:{buffer:A(this.ctx,new Float32Array(e)),numComponents:2},a_color:{buffer:A(this.ctx,new Uint8Array(r)),numComponents:4,normalize:!0,type:this.ctx.UNSIGNED_BYTE}}).runTimes(e.length/2):(this.shape=new P(this.ctx),this.shape.active().setUniforms({u_pointSize:1,u_resolution:[n,a]}).setAttributes({a_position:{buffer:A(this.ctx,new Float32Array(e)),numComponents:2},a_color:{buffer:A(this.ctx,new Uint8Array(r)),numComponents:4,normalize:!0,type:this.ctx.UNSIGNED_BYTE}}).runTimes(e.length/2).draw()),console.timeEnd("prerender")}},t.prototype.prerender=function(t){this.options.useGl?this.createBufferData(t):this.ctx instanceof CanvasRenderingContext2D&&this.createImageData()},t.prototype.render=function(t){if(console.time("render"),this.options.useGl){var e=this.ctx.canvas,r=e.width,i=e.height;this.shape.clear([0,0,0,0]).setUniforms({u_pointSize:1,u_resolution:[r,i]}).draw()}else this.ctx instanceof CanvasRenderingContext2D&&this.ctx.putImageData(this.imageData,0,0);console.timeEnd("render"),this.postrender()},t.prototype.postrender=function(){},t.Field=v,t}(),I={globalAlpha:.9,lineWidth:1,colorScale:"#fff",velocityScale:.04,maxAge:90,paths:800,frameRate:20,minVelocity:0,maxVelocity:10,useCoordsDraw:!0,gpet:!0};function D(t,e,r,i){return Math.max(0,Math.min(i.length-1,Math.round((t-e)/(r-e)*(i.length-1))))}var M=function(){function t(t,e,r){if(this.generated=!1,this.ctx=t,!this.ctx)throw new Error("ctx error");this.animate=this.animate.bind(this),this.setOptions(e),r&&this.updateData(r)}return t.prototype.setOptions=function(t){this.options=Object.assign({},I,t);var e=this.ctx.canvas,r=e.width,i=e.height;"particleAge"in t&&!("maxAge"in t)&&c(this.options.particleAge)&&(this.options.maxAge=this.options.particleAge),"particleMultiplier"in t&&!("paths"in t)&&c(this.options.particleMultiplier)&&(this.options.paths=Math.round(r*i*this.options.particleMultiplier)),this.prerender()},t.prototype.getOptions=function(){return this.options},t.prototype.updateData=function(t){this.field=t},t.prototype.moveParticles=function(){for(var t=this.ctx.canvas,e=t.width,r=t.height,i=this.particles,n=this.options.maxAge,a=o(this.options.velocityScale)?this.options.velocityScale():this.options.velocityScale,s=0,c=i.length;s<c;s++){var h=i[s];h.age>n&&(h.age=0,this.field.randomize(h,e,r,this.unproject));var u=h.x,l=h.y,p=this.field.interpolatedValueAt(u,l);if(null===p)h.age=n;else{var f=u+p.u*a,d=l+p.v*a;this.field.hasValueAt(f,d)?(h.xt=f,h.yt=d,h.m=p.m):(h.x=f,h.y=d,h.age=n)}h.age++}},t.prototype.fadeIn=function(){var t=this.ctx.globalCompositeOperation;this.ctx.globalCompositeOperation="destination-in",this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.globalCompositeOperation=t},t.prototype.drawParticles=function(){var t=this.particles;this.fadeIn(),this.ctx.globalAlpha=this.options.globalAlpha,this.ctx.fillStyle="rgba(0, 0, 0, "+this.options.globalAlpha+")",this.ctx.lineWidth=c(this.options.lineWidth)?this.options.lineWidth:1,this.ctx.strokeStyle=s(this.options.colorScale)?this.options.colorScale:"#fff";var e=0,r=t.length;if(this.field&&r>0)for(var i=this.field.range,n=i[0],o=i[1];e<r;e++)this[this.options.useCoordsDraw?"drawCoordsParticle":"drawPixelParticle"](t[e],n,o)},t.prototype.drawPixelParticle=function(t,e,r){var i=[t.x,t.y],n=[t.xt,t.yt];if(n&&i&&u(n[0])&&u(n[1])&&u(i[0])&&u(i[1])&&t.age<=this.options.maxAge){if(this.ctx.beginPath(),this.ctx.moveTo(i[0],i[1]),this.ctx.lineTo(n[0],n[1]),o(this.options.colorScale))this.ctx.strokeStyle=this.options.colorScale(t.m);else if(Array.isArray(this.options.colorScale)){var a=D(t.m,e,r,this.options.colorScale);this.ctx.strokeStyle=this.options.colorScale[a]}o(this.options.lineWidth)&&(this.ctx.lineWidth=this.options.lineWidth(t.m)),t.x=t.xt,t.y=t.yt,this.ctx.stroke()}},t.prototype.drawCoordsParticle=function(t,e,r){var i=[t.x,t.y],n=[t.xt,t.yt];if(n&&i&&u(n[0])&&u(n[1])&&u(i[0])&&u(i[1])&&this.intersectsCoordinate(n)&&t.age<=this.options.maxAge){var a=this.project(i),s=this.project(n);if(a&&s){if(this.ctx.beginPath(),this.ctx.moveTo(a[0],a[1]),this.ctx.lineTo(s[0],s[1]),t.x=t.xt,t.y=t.yt,o(this.options.colorScale))this.ctx.strokeStyle=this.options.colorScale(t.m);else if(Array.isArray(this.options.colorScale)){var c=D(t.m,e,r,this.options.colorScale);this.ctx.strokeStyle=this.options.colorScale[c]}o(this.options.lineWidth)&&(this.ctx.lineWidth=this.options.lineWidth(t.m)),this.ctx.stroke()}}},t.prototype.prepareParticlePaths=function(){var t=this.ctx.canvas,e=t.width,r=t.height,i="function"==typeof this.options.paths?this.options.paths(this):this.options.paths,n=[];if(!this.field)return[];"startBatchInterpolate"in this.field&&this.field.startBatchInterpolate(e,r,this.unproject);for(var o=0;o<i;o++)n.push(this.field.randomize({age:this.randomize()},e,r,this.unproject));return n},t.prototype.randomize=function(){return Math.floor(Math.random()*this.options.maxAge)},t.prototype.project=function(){for(var t=arguments,e=[],r=0;r<arguments.length;r++)e[r]=t[r];throw new Error("project must be overriden")},t.prototype.unproject=function(){for(var t=arguments,e=[],r=0;r<arguments.length;r++)e[r]=t[r];throw new Error("unproject must be overriden")},t.prototype.intersectsCoordinate=function(t){throw new Error("must be overriden")},t.prototype.clearCanvas=function(){this.stop(),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.forceStop=!1},t.prototype.start=function(){this.starting=!0,this.forceStop=!1,this._then=Date.now(),this.animate()},t.prototype.stop=function(){cancelAnimationFrame(this.animationLoop),this.starting=!1,this.forceStop=!0},t.prototype.animate=function(){this.animationLoop&&cancelAnimationFrame(this.animationLoop),this.animationLoop=requestAnimationFrame(this.animate);var t=Date.now(),e=t-this._then;e>this.options.frameRate&&(this._then=t-e%this.options.frameRate,this.render())},t.prototype.prerender=function(){this.generated=!1,this.particles=this.prepareParticlePaths(),this.generated=!0,this.starting||this.forceStop||(this.starting=!0,this._then=Date.now(),this.animate())},t.prototype.render=function(){this.moveParticles(),this.drawParticles(),this.postrender()},t.prototype.postrender=function(){},t.Field=v,t}();t.Field=v,t.ScalarField=F,t.TypeOf=function(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()},t.Vector=g,t.assign=function(t){for(var e=arguments,i=[],n=1;n<arguments.length;n++)i[n-1]=e[n];return Object.assign.apply(Object,r([t],i))},t.bindAttribute=function(t,e,r,i){t.bindBuffer(t.ARRAY_BUFFER,e),t.enableVertexAttribArray(r),t.vertexAttribPointer(r,i,t.FLOAT,!1,0,0)},t.bindFramebuffer=function(t,e,r){t.bindFramebuffer(t.FRAMEBUFFER,e),r&&t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0)},t.bindTexture=function(t,e,r){t.activeTexture(t.TEXTURE0+r),t.bindTexture(t.TEXTURE_2D,e)},t.clearScene=S,t.createBuffer=A,t.createCanvas=function(t,e,r,i){if("undefined"!=typeof document){var n=document.createElement("canvas");return n.width=t*r,n.height=e*r,n}return new i(t*r,e*r)},t.createProgram=w,t.createShader=b,t.createTexture=function(t,e,r,i,n){var o=t.createTexture();return t.bindTexture(t.TEXTURE_2D,o),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,e),r instanceof Uint8Array?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,i,n,0,t.RGBA,t.UNSIGNED_BYTE,r):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r),t.bindTexture(t.TEXTURE_2D,null),o},t.default=M,t.defaultOptions=I,t.destroyTexture=function(t,e){t.deleteTexture(e)},t.floorMod=h,t.formatData=function(t){var e,r;if(t.forEach((function(t){switch(t.header.parameterCategory+","+t.header.parameterNumber){case"1,2":case"2,2":e=t;break;case"1,3":case"2,3":r=t}})),r&&e){var i=e.header;return new v({xmin:i.lo1,ymin:i.la2,xmax:i.lo2,ymax:i.la1,deltaX:i.dx,deltaY:i.dy,cols:i.nx,rows:i.ny,us:e.data,vs:r.data})}},t.getColor=m,t.getDevicePixelRatio=y,t.getGlContext=function(t,e){void 0===e&&(e={});var r=["webgl","experimental-webgl"],i=null;function n(t){console.error(t.statusMessage)}t.addEventListener("webglcontextcreationerror",n,!1);for(var o=0;o<r.length;++o){try{i=t.getContext(r[o],e)}catch(t){}if(i)break}return t.removeEventListener("webglcontextcreationerror",n,!1),i&&i.getExtension("OES_texture_float")?i:null},t.isArray=function(t){return Array.isArray(t)},t.isArrayBuffer=function(t){return"[object ArrayBuffer]"===Object.prototype.toString.call(t)},t.isDate=function(t){return"[object Date]"===Object.prototype.toString.call(t)},t.isEmpty=function(t){var e;for(e in t)return!1;return!e},t.isFunction=o,t.isNull=function(t){return null==t},t.isNumber=c,t.isObject=a,t.isString=s,t.isValide=u,t.loadImage=function(t){return new Promise((function(e,r){t||r(new Event("url is null"));var i=new Image;i.onload=function(){return e(i)},i.onerror=r,i.src=t,i.complete&&e(i)}))},t.resizeCanvasSize=x,t.warnLog=function(t){console.warn("wind-layer: "+t)},Object.defineProperty(t,"__esModule",{value:!0})}));
